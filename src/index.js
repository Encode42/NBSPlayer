import{Player}from"./player/Player.js";import{load,init}from"./audio/load.js";import{resetElements}from"./util/util.js";let playbackButton,resetButton,progressBar,loopingCheck,parityCheck,currentPlayer;function setReady(e){e?(playbackButton.disabled=!1,resetButton.disabled=!1,progressBar.disabled=!1,parityCheck.disabled=!1):(playbackButton.disabled=!0,resetButton.disabled=!0,progressBar.disabled=!0,loopingCheck.disabled=!0,parityCheck.disabled=!0)}function setPlaying(e){e?(currentPlayer?.play(),playbackButton.dataset.toggled="true"):(currentPlayer?.pause(),delete playbackButton.dataset.toggled)}window.addEventListener("load",async()=>{const e=document.getElementById("file-input");progressBar=document.getElementById("progress-bar"),playbackButton=document.getElementById("playback-button"),resetButton=document.getElementById("reset-button"),loopingCheck=document.getElementById("looping-check"),parityCheck=document.getElementById("parity-check"),setReady(!1),resetElements(),await init(),e.addEventListener("change",async e=>{0!==e.target.files.length&&(await Player.stopAll(),setPlaying(!1),e=await load(e.target.files[0]),currentPlayer=new Player(e),currentPlayer.checkLooping(),currentPlayer.hasEndListener||(currentPlayer.addEventListener("end",()=>{setPlaying(!1)}),currentPlayer.hasEndListener=!0),setReady(!0))}),playbackButton.addEventListener("click",()=>{setPlaying("true"!==playbackButton.dataset.toggled)}),resetButton.addEventListener("click",()=>{currentPlayer.reset(),setPlaying(!1)}),progressBar.addEventListener("mousedown",()=>{currentPlayer.updateProgress=!1}),progressBar.addEventListener("mouseup",()=>{currentPlayer.currentTick=Math.round(progressBar.value/100*currentPlayer.lastTick),currentPlayer.updateProgress=!0}),loopingCheck.addEventListener("change",()=>currentPlayer.loop=loopingCheck.checked),parityCheck.addEventListener("change",()=>currentPlayer.useParity=parityCheck.checked)});